{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Grace/Desktop/code/fullstack-product-crud-app/product-crud-frontend/node_modules/@babel/runtime/helpers/esm/regeneratorRuntime.js\";import _objectSpread from\"C:/Users/Grace/Desktop/code/fullstack-product-crud-app/product-crud-frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _asyncToGenerator from\"C:/Users/Grace/Desktop/code/fullstack-product-crud-app/product-crud-frontend/node_modules/@babel/runtime/helpers/esm/asyncToGenerator.js\";import _slicedToArray from\"C:/Users/Grace/Desktop/code/fullstack-product-crud-app/product-crud-frontend/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from\"react\";import{useNavigate,useParams}from\"react-router-dom\";import{addProduct,updateProduct,getProductById,uploadProductThumbnail}from\"../features/apiCalls\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var BASE_API_URL=\"http://localhost:8081\";var AddProduct=function AddProduct(){var _useParams=useParams(),id=_useParams.id;var _useState=useState({productTitle:\"\",productDescription:\"\",productPrice:\"\",availableQuantity:\"\",productId:Math.floor(Math.random())}),_useState2=_slicedToArray(_useState,2),defaultValue=_useState2[0],setDeafaultValue=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),selectedImage=_useState4[0],setSelectedImage=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),previewUrl=_useState6[0],setPreviewUrl=_useState6[1];var navigate=useNavigate();useEffect(function(){var getProduct=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee(){var _yield$getProductById,data;return _regeneratorRuntime().wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.next=2;return getProductById(id);case 2:_yield$getProductById=_context.sent;data=_yield$getProductById.data;console.log(data);if(data)setDeafaultValue(_objectSpread({},data[0]));case 6:case\"end\":return _context.stop();}}},_callee);}));return function getProduct(){return _ref.apply(this,arguments);};}();getProduct();},[id]);useEffect(function(){var url;if(selectedImage){url=URL.createObjectURL(selectedImage);setPreviewUrl(url);}return function(){URL.revokeObjectURL(url);};},[selectedImage]);var productTitle=defaultValue.productTitle,productDescription=defaultValue.productDescription,productPrice=defaultValue.productPrice,availableQuantity=defaultValue.availableQuantity,productThumbnail=defaultValue.productThumbnail,productId=defaultValue.productId;var handle3000=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime().mark(function _callee2(e){var formData,fileFormData,files,values,pId,_yield$uploadProductT,data,error,_yield$updateProduct,_data,_error,formValues,_yield$addProduct,_data2,_error2;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:e.preventDefault();console.log(e.target);formData=new FormData(e.target);fileFormData=new FormData();files=e.target[4].files;values=Object.fromEntries(formData.entries());pId=!productId?values.productTitle.toLowerCase().replaceAll(/[\\s\\t]+/g,\"-\"):productId;fileFormData.append(\"productId\",pId);delete values.productThumbnail;_context2.prev=9;if(!selectedImage){_context2.next=20;break;}fileFormData.append(\"productThumbnail\",files[0]);_context2.next=14;return uploadProductThumbnail(fileFormData);case 14:_yield$uploadProductT=_context2.sent;data=_yield$uploadProductT.data;error=_yield$uploadProductT.error;if(!error){_context2.next=19;break;}throw new Error(error);case 19:values[\"productThumbnail\"]=data;case 20:if(!(pId&&!!productId)){_context2.next=30;break;}_context2.next=23;return updateProduct(values,productId);case 23:_yield$updateProduct=_context2.sent;_data=_yield$updateProduct.data;_error=_yield$updateProduct.error;if(!_error){_context2.next=28;break;}throw new Error(_error);case 28:_context2.next=39;break;case 30:if(!pId){_context2.next=39;break;}formValues=_objectSpread(_objectSpread({productId:pId},values),{},{productThumbnail:\"test-product.jpg\"});_context2.next=34;return addProduct(formValues);case 34:_yield$addProduct=_context2.sent;_data2=_yield$addProduct.data;_error2=_yield$addProduct.error;if(!_error2){_context2.next=39;break;}throw new Error(_error2);case 39:_context2.next=44;break;case 41:_context2.prev=41;_context2.t0=_context2[\"catch\"](9);console.log(_context2.t0);case 44:case\"end\":return _context2.stop();}}},_callee2,null,[[9,41]]);}));return function handle3000(_x){return _ref2.apply(this,arguments);};}();return/*#__PURE__*/_jsxs(\"div\",{className:\"container max-w-5xl py-10\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"flex space-x-6 mb-10 items-center\",children:[/*#__PURE__*/_jsx(\"button\",{onClick:function onClick(){return navigate(-1);},className:\"h-10 leading-none text-xl\",children:\"<\"}),/*#__PURE__*/_jsx(\"h2\",{className:\"text--title\",children:defaultValue.productTitle?\"Update Product\":\"Add Product\"})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex flex-col\",children:/*#__PURE__*/_jsxs(\"form\",{onSubmit:handle3000,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Product Title\"}),/*#__PURE__*/_jsx(\"input\",{defaultValue:productTitle||\"\",name:\"productTitle\",placeholder:\"Enter Product Title...\",type:\"text\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Product Description\"}),/*#__PURE__*/_jsx(\"textarea\",{defaultValue:productDescription||\"\",name:\"productDescription\",className:\"resize-none\",rows:5})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Product Price\"}),/*#__PURE__*/_jsx(\"input\",{defaultValue:productPrice,name:\"productPrice\",placeholder:\"Enter Product Price...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-4\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Available Quantity\"}),/*#__PURE__*/_jsx(\"input\",{defaultValue:availableQuantity,name:\"availableQuantity\",placeholder:\"Enter Available Quantity...\"})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"mb-10\",children:[/*#__PURE__*/_jsx(\"label\",{children:\"Product Thumbnail\"}),/*#__PURE__*/_jsx(\"input\",{onChange:function onChange(e){setSelectedImage(e.target.files[0]);},accept:\"image/*\",name:\"productThumbnail\",type:\"file\"}),(productThumbnail||previewUrl)&&/*#__PURE__*/_jsx(\"img\",{className:\"h-48\",alt:\"thumbnail\",src:previewUrl?previewUrl:\"\".concat(BASE_API_URL,\"/uploads/\").concat(productThumbnail)})]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex items-center mb-5\",children:/*#__PURE__*/_jsx(\"button\",{className:\"w-full\",children:\"submit\"})})]})})]});};export default AddProduct;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useParams","addProduct","updateProduct","getProductById","uploadProductThumbnail","BASE_API_URL","AddProduct","id","productTitle","productDescription","productPrice","availableQuantity","productId","Math","floor","random","defaultValue","setDeafaultValue","selectedImage","setSelectedImage","previewUrl","setPreviewUrl","navigate","getProduct","data","console","log","url","URL","createObjectURL","revokeObjectURL","productThumbnail","handle3000","e","preventDefault","target","formData","FormData","fileFormData","files","values","Object","fromEntries","entries","pId","toLowerCase","replaceAll","append","error","Error","formValues"],"sources":["C:/Users/Grace/Desktop/code/fullstack-product-crud-app/product-crud-frontend/src/pages/AddProduct.js"],"sourcesContent":["\r\nimport React, { useEffect, useState } from \"react\";\r\nimport { useNavigate, useParams } from \"react-router-dom\";\r\nimport {\r\n  addProduct,\r\n  updateProduct,\r\n  getProductById,\r\n  uploadProductThumbnail,\r\n} from \"../features/apiCalls\";\r\n\r\nconst BASE_API_URL = \"http://localhost:8081\";\r\nconst AddProduct = () => {\r\n  const { id } = useParams();\r\n  const [defaultValue, setDeafaultValue] = useState({\r\n    productTitle: \"\",\r\n    productDescription: \"\",\r\n    productPrice: \"\",\r\n    availableQuantity: \"\",\r\n    productId: Math.floor(Math.random())\r\n  });\r\n  const [selectedImage, setSelectedImage] = useState();\r\n  const [previewUrl, setPreviewUrl] = useState();\r\n  const navigate = useNavigate();\r\n\r\n  useEffect(() => {\r\n    const getProduct = async () => {\r\n      const { data } = await getProductById(id);\r\n      console.log(data);\r\n      if (data) setDeafaultValue({ ...data[0] });\r\n    };\r\n    getProduct();\r\n  }, [id]);\r\n\r\n  useEffect(() => {\r\n    let url;\r\n    if (selectedImage) {\r\n      url = URL.createObjectURL(selectedImage);\r\n      setPreviewUrl(url);\r\n    }\r\n    return () => {\r\n      URL.revokeObjectURL(url);\r\n    };\r\n  }, [selectedImage]);\r\n\r\n  const {\r\n    productTitle,\r\n    productDescription,\r\n    productPrice,\r\n    availableQuantity,\r\n    productThumbnail,\r\n    productId,\r\n  } = defaultValue;\r\n\r\n  const handle3000 = async (e) => {\r\n    e.preventDefault();\r\n    console.log(e.target);\r\n    let formData = new FormData(e.target);\r\n    let fileFormData = new FormData();\r\n    let files = e.target[4].files;\r\n    const values = Object.fromEntries(formData.entries());\r\n    const pId = !productId\r\n      ? values.productTitle.toLowerCase().replaceAll(/[\\s\\t]+/g, \"-\")\r\n      : productId;\r\n    fileFormData.append(\"productId\", pId);\r\n    delete values.productThumbnail;\r\n    try {\r\n      if (!!selectedImage) {\r\n        fileFormData.append(\"productThumbnail\", files[0]);\r\n        let { data, error } = await uploadProductThumbnail(fileFormData);\r\n        if (error) throw new Error(error);\r\n        values[\"productThumbnail\"] = data;\r\n      }\r\n      if (pId && !!productId) {\r\n        let { data, error } = await updateProduct(values, productId);\r\n        if (error) throw new Error(error);\r\n      } else if (pId) {\r\n        let formValues = {\r\n          productId: pId,\r\n          ...values,\r\n          productThumbnail: \"test-product.jpg\",\r\n        };\r\n        let { data, error } = await addProduct(formValues);\r\n        if (error) throw new Error(error);\r\n      }\r\n    } catch (err) {\r\n      console.log(err);\r\n    }\r\n  };\r\n  return (\r\n    <div className=\"container max-w-5xl py-10\">\r\n      <div className=\"flex space-x-6 mb-10 items-center\">\r\n        <button\r\n          onClick={() => navigate(-1)}\r\n          className=\"h-10 leading-none text-xl\"\r\n        >\r\n          {\"<\"}\r\n        </button>\r\n        <h2 className=\"text--title\">\r\n          {defaultValue.productTitle ? \"Update Product\" : \"Add Product\"}\r\n        </h2>\r\n      </div>\r\n      <div className=\"flex flex-col\">\r\n        <form onSubmit={handle3000}>\r\n          <div className=\"mb-4\">\r\n            <label>Product Title</label>\r\n            <input\r\n              defaultValue={productTitle || \"\"}\r\n              name=\"productTitle\"\r\n              placeholder=\"Enter Product Title...\"\r\n              type=\"text\"\r\n            />\r\n          </div>\r\n          <div className=\"mb-4\">\r\n            <label>Product Description</label>\r\n            <textarea\r\n              defaultValue={productDescription || \"\"}\r\n              name=\"productDescription\"\r\n              className=\"resize-none\"\r\n              rows={5}\r\n            ></textarea>\r\n          </div>\r\n          <div className=\"mb-4\">\r\n            <label>Product Price</label>\r\n            <input\r\n              defaultValue={productPrice}\r\n              name=\"productPrice\"\r\n              placeholder=\"Enter Product Price...\"\r\n            />\r\n          </div>\r\n          <div className=\"mb-4\">\r\n            <label>Available Quantity</label>\r\n            <input\r\n              defaultValue={availableQuantity}\r\n              name=\"availableQuantity\"\r\n              placeholder=\"Enter Available Quantity...\"\r\n            />\r\n          </div>\r\n          <div className=\"mb-10\">\r\n            <label>Product Thumbnail</label>\r\n            <input\r\n              onChange={(e) => {\r\n                setSelectedImage(e.target.files[0]);\r\n              }}\r\n              accept=\"image/*\"\r\n              name=\"productThumbnail\"\r\n              type={\"file\"}\r\n            />\r\n            {(productThumbnail || previewUrl) && (\r\n              <img\r\n                className=\"h-48\"\r\n                alt=\"thumbnail\"\r\n                src={\r\n                  previewUrl\r\n                    ? previewUrl\r\n                    : `${BASE_API_URL}/uploads/${productThumbnail}`\r\n                }\r\n              />\r\n            )}\r\n          </div>\r\n          <div className=\"flex items-center mb-5\">\r\n            <button className=\"w-full\">submit</button>\r\n          </div>\r\n        </form>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AddProduct;"],"mappings":"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"},"metadata":{},"sourceType":"module"}